---
title: Контрольные суммы
layout: post
tags: шифрование PGP/GPG
---

При загрузке файлов из интернета каждый хотя бы раз встречался с загадочной строчкой hash-суммы. Сейчас мы разберем суть этого явления и рассмотрим практическое использование.

Если говорить сухим языком а-ля справочник, хеш-сумма - это результат обработки неких данных хеш-функцией. Говоря проще, хеш-сумма является уникальным отпечатком данных, после малейшего изменения которых отпечаток кардинально меняется, что позволяет отследить изменения исходных данных.

Эту технологию используют повсеместно. Самый очевидный пример - хранение паролей, когда сервис не воспринимает пароль пользователя буквально, а пропускает его через хэш-функцию, и, если хэш-сумма введенного пароля совпадает с тем, что хранится в базе, пароль считается верным. Это обезопашивает сервис в случае утечки базы данных, т.к. настоящих паролей в ней нет, а только нечитаемые хеш-суммы.

Для наглядности эту сложную процедуру можно сравнить с решением уравнения, где пароль, вводимый пользователем, является набором главных переменных, от которых зависит результат. Этот же принцип используется при подписывании текстов PGP-ключом, который помимо информации о целостности файла записывает информацию о ключе, которым была произведена хеш-функция.

Существует несколько распространненых хеш-алгоритмов для проверки файлов, самые популярные из которых MD5, SHA-1, SHA-256. Главное их отличие, видимое глазу, - длина выходной хеш-суммы. Из приведенных примеров самую малую длину имеет алгоритм MD5. Наверное поэтому ходят слухи о возможности подделки данных хэш-сумм некоторыми лицами, располагающими большой вычислительной мощностью и лучшими математическими умами планеты.

Одно из множества приятных преимуществ Unix-подобных операционных систем это наличие предустановленных инструментов для работы с контрольными суммами. Самую длинную сумму выдает функция SHA-512, которой мы и рекомендуем пользоваться. На скриншоте приведены примеры просмотра контрольных хеш-сумм файла “any.deb”, на котором наглядно видно разницу в длине выводимых строк.

Можно сравнивать суммы визуально, но есть возможность автоматизировать этот процесс. Для начала скажем как сохранять полученные хеш-суммы в файл. В примере будем использовать алгоритм SHA-256, который поддерживается на Windows благодаря программе GPG4Win (PgpEX), установка которой рассматривается в [! ссылка на PGP в Windows - этой] статье.

Возвращаемся в терминал Linux.
```
sha256sum any.deb > sumtest.txt
```

Команда “ls” на скриншоте выводит содержимое папки. Мы видим файл “any.deb”, хеш-сумму которого следующей командой записываем в файл “sumtest.txt”. Название можно указать любое и не обязательно указывать расширение, но в конретном случае мы работаем с оглядкой на Windows. В папке появился новый файл. Командой “cat” мы выводим содержимое файла в терминал. Как видим, файл содержит хеш-сумму файла и его имя. Итак, корректный файл с хеш-суммой создан. Чтобы сравнить сумму файла с указанной в “sumtest.txt”, вводим команду sha256sum с ключом “-c” или “–chek”. При проверке таким способом указывать сам файл не нужно, его имя хранится в контрольном документе “sumtest.txt”, поэтому важно, чтобы проверяемый и контрольный файл лежали в одной директории.

```
sha256sum -c sumtest.txt
```

На следующем скриншоте команда проверки выдала ошибку, сообщив, что контрольные суммы не совпали. Это значит, что были изменены либо контрольная хеш-сумма, либо сам файл. В нашем случае изменена сумма. Первый символ в “sumtest.txt” был заменен.

Указанные операции одинаково работают и с другими аналогичными программами, как md5sum, sha1sum, sha512sum и другими.

Обратимся к пользователям Windows.
После установки PgpEX в контекстом меню появились пункты “Подписать и зашифровать” и “Другие параметры GpgEX”. Нас интересуют функции по работе с контрольными суммами. После клика по “Создать контрольные суммы” программам выдала отчет об успешном завершении операции. Как видим, созданный текстовый документ имеет схожее содержание с тем, что выдала программка sha256sum. К сожалению, данный инструмент для Windows работает только с функцией SHA-256.

Проверка контрольных сумм происходит аналогично: кликнув по текстовому файлу, выбираем проверку контрольных сумм. Как и в случае с Unix-подобными ОС - контрольный файл и файл проверяемый должны находиться в одном каталоге.

При практическом использовании более эффективным решением является раздельная отправка файла и его контрольной суммы. Контрольную сумму лучше всего зашифровать PGP ключом и отослать получателю файла почтой, чтобы исключить возможность подмены этих данных. Также полезной привычкой можно считать постоянную проверку контрольных сумм при скачивании файлов из интернета, правда, не всегда они предоставляются…
