# PGP-шифрование на Windows

Мы не рекомендуем операционную систему Windows ввиду ее проприетарного характера, множественных уязвимостей и полностью закрытого исходного кода, однако она имеет право на существование и, как ни странно, пользуется огромным спросом. Помним, что в некоторых случаях пользователю не предоставляется выбор ОС, например, на рабочем месте в офисе или интернет-кафе.
В этой статье мы разберем практическую часть использования PGP-шифрования на Windows на примере кроссплатформенной Kleopatra.  Бесплатный менеджер ключей Kleopatra - это графическая оболочка GnuPG, а GPG4Win - удобное решение для Windows, в состав которого входит и упомянутый продукт. Если вы не имеете общего представления о PGP-шифровании, можете ознакомиться с вводной статьей по этой теме.
Скачать PGP4Win можно с официального сайта, либо с нашего сервера. Программа распространяется бесплатно, однако на официальном сайте разработчики настойчиво просят пожертвовать, но при отсутствии возможности помочь скачать все равно можно. Для этого со страницы PayPal нужно вернуться на страницу загрузки. В разделе загрузок на сайте предоставлена контрольная сумма SHA256, при помощи которой можно удостовериться в том, что мы скачали не поврежденный файл. Если вы не знаете, что такое контрольная сумма и как ее проверять - ознакомьтесь с соответствующей статьей.
При установке предлагается выбрать нужные компоненты. В нашем случае это Kleopatra - менеджер ключей и GpgEX - удобный плагин для проводника Windows, благодаря которому в контекстном меню появляются пункты "Зашифровать", "Подписать", "Расшифровать", "Проверить контрольные суммы" и некоторые другие. GPA - еще один, более простой на вид, менеджер ключей, GpgOL - плагин PGP для почтового клиента Outlook. После завершения установки программа просит перезагрузить компьютер, но запустить Kleopatra можно сразу.
Список ключей пуст, Kleopatra предлагает импортировать существующие ключи, либо создать новый. Мы создадим новый, нажав на "Создать новую пару ключей". Заполняя поля "Имя" и "Адрес электронной почты" важно понимать, что указанные данные будут видны всем обладателям нашего публичного ключа, т.е. всем нашим собеседникам, а реальной привязки к почте не осуществляется. Поэтому в поле "Имя" можно указать любой никнейм, а электронную почту вовсе проигнорировать. Важно принять решение на этапе создания ключа. Для тонкой настройки создаваемой пары обратимся к дополнительным параметрам.
В данном примере выбран алгоритм RSA, который будет использоваться для создания подписи, сертификации, идентификации и шифрования. При выборе RSA шифрование доступно даже без дополнительной галочки +RSA, однако стоит поставить галочку и вручную установить для шифрования максимально длинный ключ в 4096 бит, взлом которого даже на современных компьютерах займет времени кратно больше, чем средняя человеческая жизнь (официально безопасным считается ключ в 2048 бит). При выборе других алгоритмов, необходимо в обязательном порядке устанавливать дополнительные галочки для того, чтобы ключом можно было зашифровывать. При выборе сложности ключа (его длины), следуем простому правилу параноика - берем самый большой.
По умолчанию пункт "Годен до" активирован и устанавливает срок годности ключа в 2 года, но при создании постоянного ключа разумно сделать его бессрочным. Переходим к созданию ключа. В процессе программа попросит ввести фразу-пароль, которая является последним рубежом защиты приватного ключа. Идеальным решением будет использование рандомно сгенерированного ключа, длина которого около 250 символов, но никто не запрещает использовать и "qwerty12345". В завершение Kleopatra покажет уникальный отпечаток ключа, который служит дополнительным средством идентификации пользователя, а также предложит сделать резервную копию, что в сути своей является экспортом закрытого ключа.

Интерфейс интуитивно понятный, но для полноты гайда разберем основные функции. В рамках этой статьи мы рассмотрим только практическую сторону. Чтобы подтянуть теорию по указанным вопросам, читайте вводную статью о шифровании PGP.
1. Шифрование и подписывание файлов.
Кнопка "Подписать/зашифровать" позволяет нам выбрать любой файл, который мы хотим зашифровать. Это может быть что угодно: архив, музыка, изображение и т.д. Размер файла ничем не ограничен. Основные функции при создании зашифрованной копии выбранного файла это "Сертификат подписи", который позволит удостоверить родительский ключ (например, точно ли файл был зашифрован нами) и раздел "Шифрование", где мы можем зашифровать файл для себя (т.е. под свой ключ), либо для выбранного адресата. Адресатов может быть несколько. При шифровании потребуется ввести фразу-пароль, после чего мы увидим отчет о проделанной работе.
2. Блокнот.
Удобным инструментом для непосредственной работы с текстом является встроенный блокнот. Во вкладке "Получатели" аналогично настраиваются подпись и шифрование, в том числе для нескольких адресатов. На первом скриншоте показан зашифрованный текст, а на втором - только подписанный, т.е. прочитать его может каждый, но обладатель нашего открытого ключа может проверить его достоверность. Если в тексте поменять хотя бы один символ или добавить пробел, проверка выявит подделку подписи. Подобную ошибку видно на скриншоте, на котором многоточие в конце второй строки заменено восклицательным знаком.
Для выхода из блокнота следует повторно кликнуть по соответствующей кнопке на панеле программы.
Поведение программы при расшифровке файлов аналогично тому, что происходит с текстом. Если файл был зашифрован не нашим публичным ключом - мы не сможем его расшифровать, если был подписан - сможем проверить подпись и убедиться в отправителе и целостности файла.
3. Заверение.
Данная функция позволяет заверить любой публичный ключ любым секретным. Заверение служит дополнительной гарантией соответствия заявленного владельца ключа реальному владельцу. По-совести следует заверять ключ только при полной уверенности.
Вопрос о заверении ключа поднимается автоматически при импорте нового ключа, в нашем случае это публичный ключ пользователя "Юзернэйм". Если мы хотим заверить полученный публичный ключ, выбираем "Да". После этого поставим галочку возле нужного имени, сравниваем контрольную сумму ключа (отпечаток) с тем, что нам сообщил сам пользователь, если сумма совпадает - подтверждаем это и жмем "Далее". У нас есть выбор: удостоверить ключ только для себя или для всех. Если мы удостоверим ключ для всех - он изменится, станет длиннее. В таком случае имеет смысл переслать подписанный ключ владельцу для дальнейшего распространения. Также нам предлагается передать заверенный сертификат (открытый ключ) на сервер ключей для общего доступа. Действуем на собственное усмотрение. Подписывая публичный ключ, мы делаем это своим приватным ключом, а для любого действия с закрытым ключом требуется фраза-пароль, которую и запросит Kleopatra.
4. Экспорт закрытого ключа, или бэкап.
Для резервного копирования, либо переноса ключа (например, на флешке), секретный ключ необходимо экспортировать. Для этого нужно кликнуть по нужной связке правой кнопкой мыши и выбрать соответствующий пункт контекстного меню. После этого нам предлагается выбирать место сохранения. Настоятельно рекомендуем указать в названии, что это секретный ключ, чтобы по ошибке не передать его вместо публичного. Снова вводим фразу-пароль и ключ экспортирован. Можем открыть его в любом текстовом редакторе. Частой практикой является печать секретного ключа на бумаге (а самые двинутые могут даже заучить его наизусть). При экспорте секретного ключа экспорт публичного не требуется, т.к. секретный является полноценным бэкапом, содержащим в себе всю информацию о ключе целиком.
5. Экспорт публичного ключа.
Теперь мы можем шифровать файлы и тексты сами для себя, но, чтобы начать диалог, необходимо поделиться своим публичным ключом с собеседником. Для этого нажимаем "Экспорт" и сохраняем файл, который можно открыть любым текстовым редактором. Для удобства название файла можно отредактировать. Для передачи открытого ключа можно использовать созданный файл, либо скопировать содержимое и отправить его в письме.

P.S. PGP инструменты, как и сам протокол, имеют стандартизированный функционал, благодаря чему освоение этой программы позволит быстро сориентироваться в любой другой аналогичной. Будем внимательны при хранении закрытого ключа, потому что, если он попадет в чужие руки, его можно считать скомпрометированным. Злоумышленнику останется только подобрать (или своровать) фразу-пароль для полного завладения нашим крипто-именем. Для импорта ключа, если он предоставлен нам только где-то в чате, достаточно создать текстовый файл и вставить в него текст ключа, после чего импортировать стандартным способом.
